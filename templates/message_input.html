<div class="message-input-area" id="message-input-area">
    <div class="input-header">
        <div class="input-actions">
            <button class="action-btn" onclick="toggleFileInput()" title="Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„">
                <i class="fas fa-paperclip"></i>
            </button>
            <button class="action-btn" onclick="insertLatex()" title="ÙØ±Ù…ÙˆÙ„ Ø±ÛŒØ§Ø¶ÛŒ">
                <i class="fas fa-square-root-alt"></i>
            </button>
            <button class="action-btn" onclick="recordAudio()" title="Ø¶Ø¨Ø· ØµØ¯Ø§">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="action-btn" onclick="toggleEmojiPicker()" title="Ø§ÛŒÙ…ÙˆØ¬ÛŒ">
                <i class="fas fa-smile"></i>
            </button>
            <button class="action-btn" onclick="clearInput()" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="input-info">
            <span class="char-count" id="char-count">0/5000</span>
            <span class="typing-indicator" id="typing-indicator" style="display: none;">
                <i class="fas fa-pencil-alt"></i> Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾...
            </span>
        </div>
    </div>
    
    <div class="file-input-area" id="file-input-area" style="display: none;">
        <div class="file-drop-zone" id="file-drop-zone">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
            <input type="file" id="file-input" multiple 
                   accept="image/*,video/*,audio/*,.pdf,.txt,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
        </div>
        <div class="file-preview-list" id="file-preview-list"></div>
        <div class="file-options">
            <select id="file-type-select">
                <option value="image">ØªØµÙˆÛŒØ±</option>
                <option value="video">ÙˆÛŒØ¯ÛŒÙˆ</option>
                <option value="audio">ØµØ¯Ø§</option>
                <option value="document">Ø³Ù†Ø¯</option>
                <option value="file">ÙØ§ÛŒÙ„</option>
            </select>
            <button class="btn-secondary" onclick="clearFiles()">
                <i class="fas fa-trash"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡
            </button>
        </div>
    </div>
    
    <div class="emoji-picker" id="emoji-picker" style="display: none;">
        <div class="emoji-categories">
            <button class="emoji-category-btn active" onclick="showEmojiCategory('smileys')">
                ğŸ˜€
            </button>
            <button class="emoji-category-btn" onclick="showEmojiCategory('animals')">
                ğŸ¶
            </button>
            <button class="emoji-category-btn" onclick="showEmojiCategory('food')">
                ğŸ
            </button>
            <button class="emoji-category-btn" onclick="showEmojiCategory('activities')">
                âš½
            </button>
            <button class="emoji-category-btn" onclick="showEmojiCategory('objects')">
                ğŸ’¡
            </button>
            <button class="emoji-category-btn" onclick="showEmojiCategory('symbols')">
                â¤ï¸
            </button>
        </div>
        <div class="emoji-grid" id="emoji-grid">
            <!-- Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
    </div>
    
    <div class="text-input-area">
        <textarea id="message-textarea" 
                  placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯... (Ø¨Ø±Ø§ÛŒ ÙØ±Ù…ÙˆÙ„ Ø§Ø² $...$ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)"
                  rows="4"
                  maxlength="5000"
                  oninput="updateCharCount()"
                  onkeydown="handleTextareaKeydown(event)"
                  onfocus="showInputHelper()"
                  onblur="hideInputHelper()"></textarea>
        
        <div class="input-footer">
            <div class="input-helper" id="input-helper" style="display: none;">
                <div class="helper-tips">
                    <span><kbd>Enter</kbd> Ø§Ø±Ø³Ø§Ù„</span>
                    <span><kbd>Shift+Enter</kbd> Ø®Ø· Ø¬Ø¯ÛŒØ¯</span>
                    <span><kbd>Ctrl+L</kbd> LaTeX</span>
                </div>
            </div>
            
            <button class="send-btn" onclick="sendMessage()" id="send-btn">
                <i class="fas fa-paper-plane"></i>
                <span>Ø§Ø±Ø³Ø§Ù„</span>
                <div class="send-loading" id="send-loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </button>
        </div>
    </div>
    
    <div class="input-modals">
        <!-- Ù…ÙˆØ¯Ø§Ù„ LaTeX -->
        <div class="modal" id="latex-input-modal">
            <div class="modal-content">
                <h3><i class="fas fa-square-root-alt"></i> ÙØ±Ù…ÙˆÙ„ Ø±ÛŒØ§Ø¶ÛŒ</h3>
                <textarea id="latex-textarea" 
                          placeholder="Ù…Ø«Ø§Ù„: \frac{a}{b} = \sqrt{c^2}"
                          rows="6"></textarea>
                <div class="latex-preview" id="latex-preview"></div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="insertLatexFromModal()">
                        <i class="fas fa-plus"></i> Ø¯Ø±Ø¬
                    </button>
                    <button class="btn-secondary" onclick="closeLatexModal()">
                        <i class="fas fa-times"></i> Ø¨Ø³ØªÙ†
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¶Ø¨Ø· ØµØ¯Ø§ -->
        <div class="modal" id="audio-recorder-modal">
            <div class="modal-content">
                <h3><i class="fas fa-microphone"></i> Ø¶Ø¨Ø· ØµØ¯Ø§</h3>
                <div class="recorder-visualizer" id="recorder-visualizer"></div>
                <div class="recorder-timer" id="recorder-timer">00:00</div>
                <div class="recorder-controls">
                    <button class="btn-record" id="btn-record-start" onclick="startRecording()">
                        <i class="fas fa-circle"></i> Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·
                    </button>
                    <button class="btn-stop" id="btn-record-stop" onclick="stopRecording()" style="display: none;">
                        <i class="fas fa-stop"></i> ØªÙˆÙ‚Ù
                    </button>
                </div>
                <div class="audio-preview" id="audio-preview" style="display: none;">
                    <audio controls id="audio-player"></audio>
                    <div class="audio-actions">
                        <button class="btn-primary" onclick="sendAudio()">
                            <i class="fas fa-paper-plane"></i> Ø§Ø±Ø³Ø§Ù„
                        </button>
                        <button class="btn-secondary" onclick="discardAudio()">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeAudioRecorder()">
                        <i class="fas fa-times"></i> Ø¨Ø³ØªÙ†
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÛŒØ§Ù…
let isRecording = false;
let mediaRecorder = null;
let audioChunks = [];
let recordingInterval = null;
let recordingSeconds = 0;
let currentEmojiCategory = 'smileys';

// Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
const emojis = {
    smileys: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¤', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ¤¯', 'ğŸ˜³', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜±', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ', 'ğŸ¤', 'ğŸ¥´', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•'],
    animals: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ', 'ğŸœ', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦', 'ğŸ¦§', 'ğŸ˜', 'ğŸ¦›', 'ğŸ¦', 'ğŸª', 'ğŸ«', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ¦™', 'ğŸ', 'ğŸ¦Œ', 'ğŸ•', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸˆ', 'ğŸ“', 'ğŸ¦ƒ', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦¢', 'ğŸ¦©', 'ğŸ‡', 'ğŸ¦', 'ğŸ¦¨', 'ğŸ¦¡', 'ğŸ¦¦', 'ğŸ¦¥', 'ğŸ', 'ğŸ€', 'ğŸ¿', 'ğŸ¦”'],
    food: ['ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶', 'ğŸ«‘', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«’', 'ğŸ§„', 'ğŸ§…', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ¥¯', 'ğŸ', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ§ˆ', 'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸ¦´', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ«“', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸ§†', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ«•', 'ğŸ¥«', 'ğŸ', 'ğŸœ', 'ğŸ²', 'ğŸ›', 'ğŸ£', 'ğŸ±', 'ğŸ¥Ÿ', 'ğŸ¦ª', 'ğŸ¤', 'ğŸ™', 'ğŸš', 'ğŸ˜', 'ğŸ¥', 'ğŸ¥ ', 'ğŸ¥®', 'ğŸ¢', 'ğŸ¡', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¥›', 'ğŸ¼', 'ğŸ«–', 'â˜•', 'ğŸµ', 'ğŸ§ƒ', 'ğŸ¥¤', 'ğŸ§‹', 'ğŸ¶', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ·', 'ğŸ¥ƒ', 'ğŸ¸', 'ğŸ¹', 'ğŸ§‰', 'ğŸ¾', 'ğŸ§Š', 'ğŸ¥„', 'ğŸ´', 'ğŸ½', 'ğŸ¥£', 'ğŸ¥¡', 'ğŸ¥¢', 'ğŸ§‚'],
    activities: ['âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ', 'ğŸ‰', 'ğŸ¾', 'ğŸ¥', 'ğŸ³', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ¥', 'ğŸ“', 'ğŸ¸', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ¥…', 'â›³', 'â›¸', 'ğŸ£', 'ğŸ¤¿', 'ğŸ½', 'ğŸ¿', 'ğŸ›·', 'ğŸ¥Œ', 'ğŸ¯', 'ğŸª€', 'ğŸª', 'ğŸ±', 'ğŸ”®', 'ğŸ®', 'ğŸ•¹', 'ğŸ°', 'ğŸ²', 'ğŸ§©', 'â™Ÿ', 'ğŸ­', 'ğŸ¨', 'ğŸ§µ', 'ğŸª¡', 'ğŸ§¶', 'ğŸª¢', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸª˜', 'ğŸ·', 'ğŸº', 'ğŸª—', 'ğŸ¸', 'ğŸª•', 'ğŸ»', 'ğŸ¬', 'ğŸ¹'],
    objects: ['ğŸ’¡', 'ğŸ”¦', 'ğŸ®', 'ğŸª”', 'ğŸ“”', 'ğŸ“•', 'ğŸ“–', 'ğŸ“—', 'ğŸ“˜', 'ğŸ“™', 'ğŸ“š', 'ğŸ““', 'ğŸ“’', 'ğŸ“ƒ', 'ğŸ“œ', 'ğŸ“„', 'ğŸ“°', 'ğŸ—', 'ğŸ“‘', 'ğŸ”–', 'ğŸ·', 'ğŸ’°', 'ğŸª™', 'ğŸ’´', 'ğŸ’µ', 'ğŸ’¶', 'ğŸ’·', 'ğŸ’¸', 'ğŸ’³', 'ğŸ§¾', 'âœ‰ï¸', 'ğŸ“§', 'ğŸ“¨', 'ğŸ“©', 'ğŸ“¤', 'ğŸ“¥', 'ğŸ“¦', 'ğŸ“«', 'ğŸ“ª', 'ğŸ“¬', 'ğŸ“­', 'ğŸ“®', 'ğŸ—³', 'âœï¸', 'âœ’ï¸', 'ğŸ–‹', 'ğŸ–Š', 'ğŸ–Œ', 'ğŸ–', 'ğŸ“', 'ğŸ’¼', 'ğŸ“', 'ğŸ“‚', 'ğŸ—‚', 'ğŸ“…', 'ğŸ“†', 'ğŸ—’', 'ğŸ—“', 'ğŸ“‡', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ“Š', 'ğŸ“‹', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“', 'ğŸ–‡', 'ğŸ“', 'ğŸ“', 'âœ‚ï¸', 'ğŸ—ƒ', 'ğŸ—„', 'ğŸ—‘', 'ğŸ”’', 'ğŸ”“', 'ğŸ”', 'ğŸ”', 'ğŸ”‘', 'ğŸ—', 'ğŸ”¨', 'ğŸª“', 'â›', 'âš’', 'ğŸ› ', 'ğŸ—¡', 'âš”ï¸', 'ğŸ”«', 'ğŸªƒ', 'ğŸ¹', 'ğŸ›¡', 'ğŸªš', 'ğŸ”§', 'ğŸª›', 'ğŸ”©', 'âš™ï¸', 'ğŸ—œ', 'âš–ï¸', 'ğŸ¦¯', 'ğŸ”—', 'â›“', 'ğŸª', 'ğŸ§°', 'ğŸ§²', 'ğŸªœ', 'âš—ï¸', 'ğŸ§ª', 'ğŸ§«', 'ğŸ§¬', 'ğŸ”¬', 'ğŸ”­', 'ğŸ“¡', 'ğŸ’‰', 'ğŸ©¸', 'ğŸ’Š', 'ğŸ©¹', 'ğŸ©º', 'ğŸšª', 'ğŸ›—', 'ğŸª', 'ğŸªŸ', 'ğŸ›', 'ğŸ›‹', 'ğŸª‘', 'ğŸš½', 'ğŸª ', 'ğŸš¿', 'ğŸ›', 'ğŸª¤', 'ğŸª’', 'ğŸ§´', 'ğŸ§·', 'ğŸ§¹', 'ğŸ§º', 'ğŸ§»', 'ğŸª£', 'ğŸ§¼', 'ğŸª¥', 'ğŸ§½', 'ğŸ§¯', 'ğŸ›’'],
    symbols: ['â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ğŸ•‰', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›', 'â›', 'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™', 'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'ğŸ†”', 'âš›ï¸', 'ğŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸', 'ğŸ“´', 'ğŸ“³', 'ğŸˆ¶', 'ğŸˆš', 'ğŸˆ¸', 'ğŸˆº', 'ğŸˆ·ï¸', 'âœ´ï¸', 'ğŸ†š', 'ğŸ’®', 'ğŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ğŸˆ´', 'ğŸˆµ', 'ğŸˆ¹', 'ğŸˆ²', 'ğŸ…°ï¸', 'ğŸ…±ï¸', 'ğŸ†', 'ğŸ†‘', 'ğŸ…¾ï¸', 'ğŸ†˜', 'âŒ', 'â­•', 'ğŸ›‘', 'â›”', 'ğŸ“›', 'ğŸš«', 'ğŸ’¯', 'ğŸ’¢', 'â™¨ï¸', 'ğŸš·', 'ğŸš¯', 'ğŸš³', 'ğŸš±', 'ğŸ”', 'ğŸ“µ', 'ğŸš­', 'â—', 'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ğŸ”…', 'ğŸ”†', 'ã€½ï¸', 'âš ï¸', 'ğŸš¸', 'ğŸ”±', 'âšœï¸', 'ğŸ”°', 'â™»ï¸', 'âœ…', 'ğŸˆ¯', 'ğŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'â', 'ğŸŒ', 'ğŸ’ ', 'â“‚ï¸', 'ğŸŒ€', 'ğŸ’¤', 'ğŸ§', 'ğŸš¾', 'â™¿', 'ğŸ…¿ï¸', 'ğŸˆ³', 'ğŸˆ‚ï¸', 'ğŸ›‚', 'ğŸ›ƒ', 'ğŸ›„', 'ğŸ›…', 'ğŸš¹', 'ğŸšº', 'ğŸš¼', 'âš§', 'ğŸš»', 'ğŸš®', 'ğŸ¦', 'ğŸ“¶', 'ğŸˆ', 'ğŸ”£', 'â„¹ï¸', 'ğŸ”¤', 'ğŸ”¡', 'ğŸ” ', 'ğŸ†–', 'ğŸ†—', 'ğŸ†™', 'ğŸ†’', 'ğŸ†•', 'ğŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ğŸ”Ÿ', 'ğŸ”¢', '#ï¸âƒ£', '*ï¸âƒ£', 'âï¸', 'â–¶ï¸', 'â¸', 'â¯', 'â¹', 'âº', 'â­', 'â®', 'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ğŸ”¼', 'ğŸ”½', 'â¡ï¸', 'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'ğŸ”„', 'ğŸ”ƒ', 'ğŸµ', 'ğŸ¶', 'â•', 'â–', 'â—', 'âœ–ï¸', 'ğŸ’²', 'ğŸ’±', 'â„¢ï¸', 'Â©ï¸', 'Â®ï¸', 'ã€°ï¸', 'â°', 'â¿', 'ğŸ”š', 'ğŸ”™', 'ğŸ”›', 'ğŸ”', 'ğŸ”œ', 'âœ”ï¸', 'â˜‘ï¸', 'ğŸ”˜', 'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'ğŸŸ¤', 'âš«', 'âšª', 'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª', 'ğŸŸ«', 'â¬›', 'â¬œ', 'â—¼ï¸', 'â—»ï¸', 'â—¾', 'â—½', 'â–ªï¸', 'â–«ï¸', 'ğŸ”¶', 'ğŸ”·', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”º', 'ğŸ”»', 'ğŸ’ ', 'ğŸ”³', 'ğŸ”²', 'ğŸ”ˆ', 'ğŸ”‡', 'ğŸ”‰', 'ğŸ”Š', 'ğŸ””', 'ğŸ”•', 'ğŸ“£', 'ğŸ“¢', 'ğŸ‘â€ğŸ—¨', 'ğŸ’¬', 'ğŸ’­', 'ğŸ—¯', 'â™ ï¸', 'â™£ï¸', 'â™¥ï¸', 'â™¦ï¸', 'ğŸƒ', 'ğŸ´', 'ğŸ€„', 'ğŸ•', 'ğŸ•‘', 'ğŸ•’', 'ğŸ•“', 'ğŸ•”', 'ğŸ••', 'ğŸ•–', 'ğŸ•—', 'ğŸ•˜', 'ğŸ•™', 'ğŸ•š', 'ğŸ•›', 'ğŸ•œ', 'ğŸ•', 'ğŸ•', 'ğŸ•Ÿ', 'ğŸ• ', 'ğŸ•¡', 'ğŸ•¢', 'ğŸ•£', 'ğŸ•¤', 'ğŸ•¥', 'ğŸ•¦', 'ğŸ•§']
};

// Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ Ø§ÛŒÙ…ÙˆØ¬ÛŒ
function toggleEmojiPicker() {
    const picker = document.getElementById('emoji-picker');
    if (picker.style.display === 'none') {
        picker.style.display = 'block';
        showEmojiCategory(currentEmojiCategory);
    } else {
        picker.style.display = 'none';
    }
}

function showEmojiCategory(category) {
    currentEmojiCategory = category;
    const grid = document.getElementById('emoji-grid');
    grid.innerHTML = '';
    
    // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
    document.querySelectorAll('.emoji-category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
    emojis[category].forEach(emoji => {
        const emojiBtn = document.createElement('button');
        emojiBtn.className = 'emoji-btn';
        emojiBtn.textContent = emoji;
        emojiBtn.onclick = () => insertEmoji(emoji);
        grid.appendChild(emojiBtn);
    });
}

function insertEmoji(emoji) {
    const textarea = document.getElementById('message-textarea');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    
    textarea.value = textarea.value.substring(0, start) + 
                     emoji + 
                     textarea.value.substring(end);
    
    textarea.focus();
    textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
    
    updateCharCount();
}

// Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ÛŒ Ù…ØªÙ†
function updateCharCount() {
    const textarea = document.getElementById('message-textarea');
    const charCount = document.getElementById('char-count');
    const count = textarea.value.length;
    
    charCount.textContent = `${count}/5000`;
    
    if (count > 4500) {
        charCount.style.color = '#f72585';
    } else if (count > 4000) {
        charCount.style.color = '#f8961e';
    } else {
        charCount.style.color = 'rgba(255, 255, 255, 0.7)';
    }
}

function handleTextareaKeydown(event) {
    // Enter Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ (Ø¨Ø¯ÙˆÙ† Shift)
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
    
    // Ctrl+L Ø¨Ø±Ø§ÛŒ LaTeX
    if (event.ctrlKey && event.key === 'l') {
        event.preventDefault();
        insertLatex();
    }
    
    // Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª ØªØ§ÛŒÙ¾
    showTypingIndicator();
}

function showTypingIndicator() {
    const indicator = document.getElementById('typing-indicator');
    indicator.style.display = 'inline';
    
    clearTimeout(window.typingTimeout);
    window.typingTimeout = setTimeout(() => {
        indicator.style.display = 'none';
    }, 2000);
}

function showInputHelper() {
    const helper = document.getElementById('input-helper');
    helper.style.display = 'block';
}

function hideInputHelper() {
    const helper = document.getElementById('input-helper');
    helper.style.display = 'none';
}

// Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
function toggleFileInput() {
    const fileArea = document.getElementById('file-input-area');
    fileArea.style.display = fileArea.style.display === 'none' ? 'block' : 'none';
    
    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ù¾ÛŒÚ©Ø± Ø§Ú¯Ø± Ø¨Ø§Ø² Ø§Ø³Øª
    document.getElementById('emoji-picker').style.display = 'none';
}

function setupFileDropZone() {
    const dropZone = document.getElementById('file-drop-zone');
    const fileInput = document.getElementById('file-input');
    
    dropZone.addEventListener('click', () => fileInput.click());
    
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
        dropZone.style.borderColor = '#4361ee';
    });
    
    dropZone.addEventListener('dragleave', () => {
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '';
        dropZone.style.borderColor = '';
        
        const files = e.dataTransfer.files;
        handleFileSelection(files);
    });
    
    fileInput.addEventListener('change', (e) => {
        handleFileSelection(e.target.files);
    });
}

function handleFileSelection(files) {
    const previewList = document.getElementById('file-preview-list');
    
    Array.from(files).forEach(file => {
        if (file.size > 16 * 1024 * 1024) { // 16MB
            showNotification(`ÙØ§ÛŒÙ„ ${file.name} Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø¨Ø²Ø±Ú¯ Ø§Ø³Øª`, 'error');
            return;
        }
        
        const fileItem = createFilePreview(file);
        previewList.appendChild(fileItem);
    });
    
    showNotification(`${files.length} ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'success');
}

function createFilePreview(file) {
    const item = document.createElement('div');
    item.className = 'file-preview-item';
    item.dataset.filename = file.name;
    
    const icon = getFileIcon(file.type);
    const size = formatFileSize(file.size);
    
    item.innerHTML = `
        <div class="file-icon">${icon}</div>
        <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${size}</div>
        </div>
        <button class="file-remove" onclick="removeFilePreview(this)">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    return item;
}

function removeFilePreview(button) {
    const item = button.closest('.file-preview-item');
    item.remove();
}

function clearFiles() {
    const previewList = document.getElementById('file-preview-list');
    previewList.innerHTML = '';
    document.getElementById('file-input').value = '';
}

// Ø¶Ø¨Ø· ØµØ¯Ø§
function startRecording() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showNotification('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'error');
        return;
    }
    
    navigator.mediaDevices.getUserMedia({ 
        audio: {
            echoCancellation: true,
            noiseSuppression: true,
            sampleRate: 44100
        }
    }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const audioUrl = URL.createObjectURL(audioBlob);
            
            showAudioPreview(audioUrl, audioBlob);
            
            // ØªÙˆÙ‚Ù Ø§Ø³ØªØ±ÛŒÙ…
            stream.getTracks().forEach(track => track.stop());
        };
        
        mediaRecorder.start();
        isRecording = true;
        
        // Ø¢Ù¾Ø¯ÛŒØª UI
        document.getElementById('btn-record-start').style.display = 'none';
        document.getElementById('btn-record-stop').style.display = 'block';
        
        // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø±
        recordingSeconds = 0;
        recordingInterval = setInterval(updateRecordingTimer, 1000);
        
    }).catch(error => {
        console.error('Error accessing microphone:', error);
        showNotification('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª', 'error');
    });
}

function stopRecording() {
    if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        
        // Ø¢Ù¾Ø¯ÛŒØª UI
        document.getElementById('btn-record-start').style.display = 'block';
        document.getElementById('btn-record-stop').style.display = 'none';
        
        // ØªÙˆÙ‚Ù ØªØ§ÛŒÙ…Ø±
        if (recordingInterval) {
            clearInterval(recordingInterval);
            recordingInterval = null;
        }
    }
}

function updateRecordingTimer() {
    recordingSeconds++;
    const minutes = Math.floor(recordingSeconds / 60).toString().padStart(2, '0');
    const seconds = (recordingSeconds % 60).toString().padStart(2, '0');
    
    document.getElementById('recorder-timer').textContent = `${minutes}:${seconds}`;
    
    // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 5 Ø¯Ù‚ÛŒÙ‚Ù‡
    if (recordingSeconds >= 300) {
        stopRecording();
    }
}

function showAudioPreview(audioUrl, audioBlob) {
    const preview = document.getElementById('audio-preview');
    const player = document.getElementById('audio-player');
    
    player.src = audioUrl;
    preview.style.display = 'block';
    preview.dataset.audioBlob = URL.createObjectURL(audioBlob);
}

function sendAudio() {
    const audioUrl = document.getElementById('audio-preview').dataset.audioBlob;
    if (audioUrl) {
        // Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
        showNotification('Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'success');
        closeAudioRecorder();
    }
}

function discardAudio() {
    document.getElementById('audio-preview').style.display = 'none';
    document.getElementById('audio-player').src = '';
}

function closeAudioRecorder() {
    document.getElementById('audio-recorder-modal').style.display = 'none';
    discardAudio();
}

// LaTeX
function insertLatex() {
    document.getElementById('latex-input-modal').style.display = 'flex';
}

function insertLatexFromModal() {
    const latexTextarea = document.getElementById('latex-textarea');
    const mainTextarea = document.getElementById('message-textarea');
    
    if (latexTextarea.value.trim()) {
        const latex = latexTextarea.value.trim();
        let formattedLatex;
        
        if (latex.includes('\\begin{') || latex.includes('\\[')) {
            formattedLatex = `$$${latex}$$`;
        } else {
            formattedLatex = `$${latex}$`;
        }
        
        mainTextarea.value += formattedLatex + ' ';
        mainTextarea.focus();
        
        closeLatexModal();
        updateCharCount();
    }
}

function closeLatexModal() {
    document.getElementById('latex-input-modal').style.display = 'none';
    document.getElementById('latex-textarea').value = '';
    document.getElementById('latex-preview').innerHTML = '';
}

// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
async function sendMessage() {
    const textarea = document.getElementById('message-textarea');
    const message = textarea.value.trim();
    const files = document.getElementById('file-input').files;
    
    if (!message && files.length === 0) {
        showNotification('Ù„Ø·ÙØ§ Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'warning');
        return;
    }
    
    // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„
    const sendBtn = document.getElementById('send-btn');
    const loading = document.getElementById('send-loading');
    sendBtn.disabled = true;
    loading.style.display = 'block';
    
    // Ø§ÛŒØ¬Ø§Ø¯ FormData
    const formData = new FormData();
    formData.append('content', message);
    formData.append('chat_type', currentChatType);
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    if (files.length > 0) {
        const fileType = document.getElementById('file-type-select').value;
        formData.append('message_type', fileType);
        
        Array.from(files).forEach(file => {
            formData.append('file', file);
        });
    }
    
    try {
        const response = await fetch('/api/send_message', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
            textarea.value = '';
            clearFiles();
            updateCharCount();
            
            if (result.ai_response) {
                // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                setTimeout(() => {
                    addMessageToChat('ai', result.ai_response);
                }, 500);
            }
            
            // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…Ø¬Ø¯Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
            loadMessages();
        } else {
            showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…', 'error');
        }
        
    } catch (error) {
        console.error('Error:', error);
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…', 'error');
    } finally {
        // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡
        sendBtn.disabled = false;
        loading.style.display = 'none';
    }
}

// Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒ
function clearInput() {
    const textarea = document.getElementById('message-textarea');
    textarea.value = '';
    clearFiles();
    updateCharCount();
    textarea.focus();
}

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener('DOMContentLoaded', function() {
    // ØªÙ†Ø¸ÛŒÙ… Drop Zone Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    setupFileDropZone();
    
    // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    const savedText = localStorage.getItem('draft_message');
    if (savedText) {
        document.getElementById('message-textarea').value = savedText;
        updateCharCount();
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ØªÙ†
    const textarea = document.getElementById('message-textarea');
    textarea.addEventListener('input', () => {
        localStorage.setItem('draft_message', textarea.value);
    });
    
    console.log('Message input initialized');
});
</script>

<style>
/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÛŒØ§Ù… */
.message-input-area {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.input-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.02);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.input-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-btn:hover {
    background: #4361ee;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
}

.input-info {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 14px;
}

.char-count {
    color: rgba(255, 255, 255, 0.7);
}

.typing-indicator {
    color: #4cc9f0;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: pulse 2s infinite;
}

/* ÙØ§ÛŒÙ„ Ø§ÛŒÙ†Ù¾ÙˆØª */
.file-input-area {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.file-drop-zone {
    border: 2px dashed #4361ee;
    border-radius: 15px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: rgba(67, 97, 238, 0.05);
}

.file-drop-zone:hover {
    background: rgba(67, 97, 238, 0.1);
    border-color: #4cc9f0;
}

.file-drop-zone i {
    font-size: 48px;
    color: #4361ee;
    margin-bottom: 15px;
}

.file-drop-zone p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
}

.file-preview-list {
    margin-top: 20px;
    max-height: 200px;
    overflow-y: auto;
}

.file-preview-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    margin-bottom: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.file-preview-item:hover {
    background: rgba(67, 97, 238, 0.1);
    transform: translateX(-5px);
}

.file-icon {
    font-size: 24px;
    color: #4361ee;
    width: 40px;
    text-align: center;
}

.file-info {
    flex: 1;
    min-width: 0;
}

.file-name {
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-size {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.5);
}

.file-remove {
    background: transparent;
    border: none;
    color: #f72585;
    cursor: pointer;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.file-remove:hover {
    background: rgba(247, 37, 133, 0.1);
}

.file-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    gap: 15px;
}

.file-options select {
    flex: 1;
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: white;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ù¾ÛŒÚ©Ø± */
.emoji-picker {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    max-height: 300px;
    overflow-y: auto;
}

.emoji-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    overflow-x: auto;
}

.emoji-category-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid transparent;
    border-radius: 10px;
    width: 45px;
    height: 45px;
    cursor: pointer;
    font-size: 20px;
    transition: all 0.3s;
}

.emoji-category-btn:hover,
.emoji-category-btn.active {
    background: rgba(67, 97, 238, 0.2);
    border-color: #4361ee;
    transform: translateY(-2px);
}

.emoji-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 10px;
}

.emoji-btn {
    background: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s;
}

.emoji-btn:hover {
    background: rgba(67, 97, 238, 0.2);
    transform: scale(1.2);
}

/* ÙˆØ±ÙˆØ¯ÛŒ Ù…ØªÙ† */
.text-input-area {
    padding: 20px;
}

#message-textarea {
    width: 100%;
    padding: 18px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    resize: none;
    font-size: 16px;
    color: white;
    line-height: 1.6;
    transition: all 0.3s;
    font-family: inherit;
}

#message-textarea:focus {
    outline: none;
    border-color: #4361ee;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.input-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
}

.input-helper {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.5);
}

.helper-tips {
    display: flex;
    gap: 15px;
}

.helper-tips kbd {
    background: rgba(67, 97, 238, 0.2);
    color: white;
    padding: 3px 8px;
    border-radius: 5px;
    font-family: monospace;
    font-size: 12px;
    border: 1px solid rgba(67, 97, 238, 0.3);
}

.send-btn {
    background: linear-gradient(135deg, #4361ee, #3a0ca3);
    color: white;
    border: none;
    padding: 0 35px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    min-width: 120px;
    justify-content: center;
}

.send-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(67, 97, 238, 0.4);
}

.send-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.send-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(67, 97, 238, 0.9);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

/* Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ */
.input-modals .modal-content {
    max-width: 500px;
}

.latex-preview {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    min-height: 60px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.btn-primary {
    background: linear-gradient(135deg, #4361ee, #3a0ca3);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
}

.recorder-visualizer {
    width: 100%;
    height: 100px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 14px;
}

.recorder-timer {
    text-align: center;
    font-size: 32px;
    font-family: monospace;
    color: #4cc9f0;
    margin: 15px 0;
}

.recorder-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 25px 0;
}

.btn-record {
    background: #f72585;
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
}

.btn-record:hover {
    background: #e11575;
    transform: scale(1.05);
    box-shadow: 0 10px 25px rgba(247, 37, 133, 0.3);
}

.btn-stop {
    background: #f8961e;
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
}

.btn-stop:hover {
    background: #e8860e;
    transform: scale(1.05);
    box-shadow: 0 10px 25px rgba(248, 150, 30, 0.3);
}

.audio-preview {
    margin: 25px 0;
}

.audio-actions {
    display: flex;
    gap: 15px;
    margin-top: 15px;
}

/* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ */
@keyframes slideUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.message-input-area {
    animation: slideUp 0.5s ease-out;
}

/* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
@media (max-width: 768px) {
    .input-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .input-info {
        width: 100%;
        justify-content: space-between;
    }
    
    .helper-tips {
        flex-direction: column;
        gap: 8px;
    }
    
    .emoji-grid {
        grid-template-columns: repeat(6, 1fr);
    }
    
    .file-options {
        flex-direction: column;
        align-items: stretch;
    }
    
    .modal-actions {
        flex-direction: column;
    }
}
</style>
